<ui:composition template="index.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core">

   <ui:define name="content">
      <h1>Liste des Éléments</h1>

      <h:form id="mainForm">
         <p:inputText id="searchQuery" value="#{myBean.searchQuery}" placeholder="Rechercher..." />
         <p:commandButton id="searchButton" value="Chercher" action="#{myBean.refreshIframe}" process="@this" />

         <p:remoteCommand name="callElements" action="#{myBean.getElementsAsJson}" process="@this"  oncomplete="handleCallElements(xhr, status, args)"/>
      </h:form>

      <!-- Ajout de l'iframe pour afficher les éléments ajoutés -->
      <iframe id="reactIframeSearch" src="http://localhost:3000/search-only" width="100%" height="600px" frameborder="0" style="margin-top: 20px;"></iframe>

      <script type="text/javascript">

         window.onload= function() {
            callElements();
         };
         function handleCallElements(xhr, status, args) {

            let elementsJsonString = args.elements;
            let elements = JSON.parse(elementsJsonString);
            let iframe = document.getElementById('reactIframeSearch');
            iframe.contentWindow.postMessage(elements, '*');
         }

      </script>
   </ui:define>
</ui:composition>
